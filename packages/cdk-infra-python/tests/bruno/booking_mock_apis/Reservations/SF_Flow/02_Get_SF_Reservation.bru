meta {
  name: Get San Francisco Reservation
  type: http
  seq: 2
}

get {
  url: {{apiUrl}}/reservation/hotel/{{sfHotel.Id}}/{{sfConfirmationNumber}}
  body: none
  auth: none

headers {
  X-Api-Key: {{apiKey}}
}
}

script:pre-request {
  console.log(`Looking up reservation: ${bru.getEnvVar("sfConfirmationNumber")}`);
  
  // Validate we have required data before executing
  if (!bru.getEnvVar("sfConfirmationNumber")) {
    console.error("‚ùå Missing confirmation number! Run 01_Create_SF_Reservation.bru first");
  }
}

tests {
  test("Status code is 200", function() {
    expect(res.status).to.equal(200);
  });
  
  test("Response includes correct hotel ID", function() {
    expect(res.body).to.have.property("Hotel");
    expect(res.body.Hotel).to.have.property("Id", parseInt(bru.getEnvVar("sfHotel.Id")));
  });
  
  test("Response includes correct reservation status", function() {
    expect(res.body).to.have.property("status", "Confirmed");
  });
}
