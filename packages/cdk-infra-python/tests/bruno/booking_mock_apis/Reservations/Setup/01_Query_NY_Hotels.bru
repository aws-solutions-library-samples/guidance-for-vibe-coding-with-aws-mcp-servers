meta {
  name: Query New York Hotels (Setup)
  type: http
  seq: 1
}

post {
  url: {{propertyResolutionApiUrl}}/property-resolution
  body: json
  auth: none
}

headers {
  Content-Type: application/json
  X-Api-Key: {{propertyResolutionApiKey}}
}

body:json {
  {
    "unique_client_id": "AWS_PACE_Agent",
    "anon_guest_id": "guest_setup",
    "input": {
      "query": "new york"
    },
    "session_context": {
      "session_id": "session_setup_{{testId}}",
      "local_ts": "2025-05-21T12:00:00Z",
      "country_name": "United States",
      "region_name": "New York",
      "city_name": "New York",
      "user_agent": "Bruno Setup Client"
    }
  }
}

tests {
  test("Status code is 200", function() {
    expect(res.status).to.equal(200);
  });
  
  test("Response includes hotels", function() {
    expect(res.body).to.have.property("statusCode");
    expect(res.body.statusCode).to.equal(200);
    
    expect(res.body).to.have.property("result");
    expect(res.body.result).to.be.an("array").that.is.not.empty;
  });
  
  test("Store first hotel for NY tests", function() {
    if (res.body.result && res.body.result.length > 0) {
      const nyHotel = res.body.result[0];
      bru.setEnvVar("nyHotel.Id", nyHotel.hotel_id);
      bru.setEnvVar("nyHotel.Code", nyHotel.spirit_cd);
      bru.setEnvVar("nyHotel.Name", nyHotel.metadata.property_name);
      console.log("NY Hotel stored:", nyHotel.metadata.property_name);
    }
  });
}
