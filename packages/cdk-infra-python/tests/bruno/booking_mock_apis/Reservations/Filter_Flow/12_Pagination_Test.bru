meta {
  name: Pagination Test
  type: http
  seq: 12
}

get {
  url: {{apiUrl}}/reservation?pageStart=0&pageSize=2
  body: none
  auth: awsv4
}

auth:awsv4 {
  accessKeyId: {{awsAccessKeyId}}
  secretAccessKey: {{awsSecretAccessKey}}
  sessionToken: {{awsSessionToken}}
  service: execute-api
  region: {{awsRegion}}
}

headers {
  X-Api-Key: {{apiKey}}
}

params:query {
  pageStart: 0
  pageSize: 2
}

script:pre-request {
  console.log(`Testing pagination with pageStart=0 and pageSize=2`);
}

tests {
  test("Status code is 200", function() {
    expect(res.status).to.equal(200);
  });
  
  test("Response includes pagination data", function() {
    expect(res.body).to.have.property("pagination");
    expect(res.body.pagination).to.have.property("total");
    expect(res.body.pagination).to.have.property("start", 0);
    expect(res.body.pagination).to.have.property("size", 2);
  });
  
  test("Response includes exactly 2 reservations", function() {
    expect(res.body).to.have.property("reservations");
    expect(res.body.reservations).to.be.an('array');
    expect(res.body.reservations.length).to.equal(2);
  });
  
  test("Total count is greater than page size", function() {
    expect(res.body.pagination.total).to.be.at.least(3); // We know we have at least 3 reservations
  });
  
  test("Testing if there's more pages", function() {
    const totalReservations = res.body.pagination.total;
    const pageSize = res.body.pagination.size;
    
    // There should be more pages if totalReservations > pageSize
    console.log(`Total reservations: ${totalReservations}, Page size: ${pageSize}`);
    const hasMorePages = totalReservations > pageSize;
    
    // Just logging this for information - not a fail condition
    if (hasMorePages) {
      console.log(`✅ There are more pages available (total: ${totalReservations}, showing: ${pageSize})`);
    } else {
      console.log(`⚠️ No more pages available (total: ${totalReservations}, showing: ${pageSize})`);
    }
  });
}
