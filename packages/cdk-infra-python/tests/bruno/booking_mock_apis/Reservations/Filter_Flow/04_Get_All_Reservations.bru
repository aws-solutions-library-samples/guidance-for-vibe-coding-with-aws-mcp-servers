meta {
  name: Get All Reservations
  type: http
  seq: 4
}

get {
  url: {{apiUrl}}/reservation?pageSize=0
  body: none
  auth: none

headers {
  X-Api-Key: {{apiKey}}
}
}

params:query {
  pageSize: 0
}

script:pre-request {
  console.log(`Checking all reservations`);
  
  // Validate we have created reservations successfully
  if (!bru.getEnvVar("chicagoConfirmationNumber") || 
      !bru.getEnvVar("mvConfirmationNumber") ||
      !bru.getEnvVar("chicagoMileConfirmationNumber")) {
    console.warn("⚠️ Warning: Not all confirmation numbers are available. Run the first three requests first!");
  }
}

tests {
  test("Status code is 200", function() {
    expect(res.status).to.equal(200);
  });
  
  test("Response includes pagination data", function() {
    expect(res.body).to.have.property("pagination");
    expect(res.body.pagination).to.have.property("total");
    expect(res.body.pagination.total).to.be.at.least(3);
  });
  
  test("Response includes reservations array", function() {
    expect(res.body).to.have.property("reservations");
    expect(res.body.reservations).to.be.an('array');
    expect(res.body.reservations.length).to.be.at.least(3);
  });
  
  test("Created reservations are included", function() {
    const confirmationNumbers = res.body.reservations.map(r => r.CrsConfirmationNumber);
    expect(confirmationNumbers).to.include(bru.getEnvVar("chicagoConfirmationNumber"));
    expect(confirmationNumbers).to.include(bru.getEnvVar("mvConfirmationNumber"));
    expect(confirmationNumbers).to.include(bru.getEnvVar("chicagoMileConfirmationNumber"));
  });
}
