meta {
  name: Update Mountain View Reservation Status
  type: http
  seq: 13.5
}

patch {
  url: {{apiUrl}}/reservation
  body: json
  auth: none
}

headers {
  Content-Type: application/json
}

body:json {
  {
    "Reservations": [
      {
        "CrsConfirmationNumber": "{{mvConfirmationNumber}}",
        "status": "Confirmed"
      }
    ]
  }
}

script:pre-request {
  console.log(`Updating Mountain View reservation status to Confirmed: ${bru.getEnvVar("mvConfirmationNumber")}`);
  
  // Validate we have created the reservation successfully
  if (!bru.getEnvVar("mvConfirmationNumber")) {
    console.error("‚ùå Mountain View confirmation number is missing! Run the creation request first!");
  }
}

tests {
  test("Status code is 200", function() {
    expect(res.status).to.equal(200);
  });
  
  test("Response includes the updated reservation", function() {
    expect(res.body).to.have.property("reservations");
    expect(res.body.reservations).to.be.an('array');
    expect(res.body.reservations.length).to.equal(1);
    
    const reservation = res.body.reservations[0];
    expect(reservation).to.have.property("CrsConfirmationNumber", bru.getEnvVar("mvConfirmationNumber"));
  });
  
  test("Reservation status has been updated to Confirmed", function() {
    const reservation = res.body.reservations[0];
    expect(reservation).to.have.property("status", "Confirmed");
  });
}
